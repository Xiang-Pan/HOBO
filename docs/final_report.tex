\hypertarget{project-information}{%
\section{Project Information}\label{project-information}}

Project ID: 210310187

Project Name: Auto tuner for vector indexing parameters

Time Planning: Basic BOHB optimization in mid term.

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

For solving the optimization of milvus hyperparameters, we use the
Bayesian Optimization and
Hyperband(BOHB)\protect\hyperlink{refer-anchor-1}{1} as our parameter
search method.

\hypertarget{implementation}{%
\section{Implementation}\label{implementation}}

There are several level hyperparameters in milvus, including
index\_type, index\_params and search\_params. To get an end-to-end
solution for index, we use BOHB in different level. For Index Type, to
eminent the randomness of BO for index\_type(which means BO may not
fully explore some specific type due to init poor performance), we set
two index type optimization mode(Loop and BO).

\hypertarget{loss-function}{%
\subsection{Loss Function}\label{loss-function}}

We use laplace method to conver the constraint BO to unconstraint
version. Our loss function is as below:

\[ Loss = sign(recall, threshold) - query\_per\_sec \]

\[Sign(recall, threshold) = 
\begin{cases}  
recall - threshold & recall>threshold \\
100000 * (threshold - x) & recall<=threshold,
\end{cases}\]

100000 is just a large number for Lagrange method, \textbf{threshold is
set to 95}.

\hypertarget{method}{%
\subsection{Method}\label{method}}

\begin{figure}
\centering
\includegraphics{./figures/flow.png}
\caption{Model Architecture}
\end{figure}

\hypertarget{hardwareware-information}{%
\section{Hardwareware Information}\label{hardwareware-information}}

CPU: Intel Core i7-8700 CPU @ 4.6GHz\\
RAM: 2182MiB / 32083MiB

\hypertarget{index-type-optimization-results}{%
\section{Index Type Optimization
Results}\label{index-type-optimization-results}}

\hypertarget{section}{%
\subsection{}\label{section}}

\begin{longtable}[]{@{}llllllll@{}}
\toprule
Method & index\_type & M & efConstruction & ef & recall &
query\_per\_sec & loss \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/14pnimgi}{BOHB(Index Type
Loop)} & `HNSW' & 17 & 445 & 114 & 99.68 & 16782.6 & -16777.9 \\
\href{https://wandb.ai/xiang-pan/HOBO/runs/13jdknsy}{BOHB(Index Type
BO)} & `HNSW' & 22 & 274 & 106 & 99.75 & 18522 & -18517.2 \\
\bottomrule
\end{longtable}

\begin{longtable}[]{@{}llllllll@{}}
\toprule
& index\_type & nlist & M & nprobe & recall & query\_per\_sec & loss \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/3vdvm6gs}{Grid Search} &
`HNSW' & 4 & 158 & 200 & 97.11 & 18331.748252 & -18329.638252 \\
\bottomrule
\end{longtable}

\hypertarget{index-parameters-optimization}{%
\section{Index Parameters
Optimization}\label{index-parameters-optimization}}

\hypertarget{ivf_flat}{%
\subsection{IVF\_FLAT}\label{ivf_flat}}

\begin{longtable}[]{@{}lllllll@{}}
\toprule
& index\_type & nlist & nprobe & recall & query\_per\_sec & loss \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/9ughlu3l}{BOHB} & `IVF\_FLAT'
& 2883 & 54 & 99.68 & 14911 & -14906.3 \\
\href{https://wandb.ai/xiang-pan/HOBO/runs/22n2lk07}{Grid Search} &
`IVF\_FLAT' & 14601 & 101 & 100.0 & 14402.032758 & -14397.032758 \\
\bottomrule
\end{longtable}

\hypertarget{ivf_sq8}{%
\subsection{IVF\_SQ8}\label{ivf_sq8}}

\begin{longtable}[]{@{}lllllll@{}}
\toprule
& index\_type & nlist & nprobe & recall & query\_per\_sec & loss \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/2hnt39qn}{BOHB} & `IVF\_SQ8'
& 8405 & 46 & 98.86 & 13827.5 & -13823.7 \\
\href{https://wandb.ai/xiang-pan/HOBO/runs/26z6cea5}{Grid Search} &
`IVF\_SQ8' & 5401 & 101 & 99.49 & 13080.62997 & -13076.13997 \\
\bottomrule
\end{longtable}

\hypertarget{ivf_pq}{%
\subsection{IVF\_PQ}\label{ivf_pq}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.5737}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0632}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0263}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0368}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0421}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0421}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1053}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1105}}@{}}
\toprule
\begin{minipage}[b]{\linewidth}\raggedright
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
index\_type
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
m
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
nlist
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
nprobe
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
recall
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
query\_per\_sec
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
loss
\end{minipage} \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/2hh95hjr}{BOHB} & `IVF\_PQ' &
128 & 3800 & 205 & 98.1 & 1289.0043055892756 & -1285.9043055892757 \\
\href{https://wandb.ai/xiang-pan/HOBO/runs/2hh95hjr}{Grid Search} (note:
Loss is not correct in the wandb table) & `IVF\_PQ' & 64 & 1 & 1 & 95.08
& 1733.677784 & -7629.256438 \\
\bottomrule
\end{longtable}

\hypertarget{hnsw}{%
\subsection{HNSW}\label{hnsw}}

\begin{longtable}[]{@{}llllllll@{}}
\toprule
Method & index\_type & M & efConstruction & ef & recall &
query\_per\_sec & loss \\
\midrule
\endhead
\href{https://wandb.ai/xiang-pan/HOBO/runs/1gkilnbh}{BOHB} & `HNSW' & 18
& 92 & 157 & 99.85 & 17868.6 & -17863.8 \\
\href{https://wandb.ai/xiang-pan/HOBO/runs/3vdvm6gs}{Grid Search} &
`HNSW' & 4 & 158 & 200 & 97.11 & 18331.748252 & -18329.638252 \\
\bottomrule
\end{longtable}

\hypertarget{core-code-annotations}{%
\section{Core Code Annotations}\label{core-code-annotations}}

\hypertarget{section-1}{%
\subsection{}\label{section-1}}

\hypertarget{attemption}{%
\section{Attemption}\label{attemption}}

\hypertarget{vae}{%
\subsection{VAE}\label{vae}}

To optimize the performance of embedding dataset in milvus, we are
trying to change the embeding space an

\hypertarget{gnn-based-message-passing}{%
\subsection{GNN-Based Message Passing}\label{gnn-based-message-passing}}

\hypertarget{minimum-distrotion}{%
\subsection{Minimum Distrotion}\label{minimum-distrotion}}

\hypertarget{references}{%
\section{References}\label{references}}

\hypertarget{refer-anchor-1}{}

\begin{itemize}
\tightlist
\item
  \href{https://arxiv.org/pdf/1807.01774.pdf}{BOHB}
\end{itemize}
